# 宠物日记小程序（微信云开发版）两周首发计划 + 增长路线

> 目标：**2 周内发布第一版（V1）**，优先上线“可用闭环”；其后通过数据驱动进入快速增长迭代。

## 1. 产品策略：两周上线的需求裁剪

## 1.1 V1 必须有（P0）

- 微信登录与用户初始化（无登录不进业务）
- 单宠物档案（新增/编辑/查看）
- 日常记录（图文发布 + 时间线浏览）
- 提醒系统基础版（新增提醒、到期展示、完成打卡）
- 首页聚合（今日提醒 + 最近 5 条动态）

> 原则：只做“记录 -> 提醒 -> 完成”主路径，保证用户首周能形成使用习惯。

## 1.2 V1 暂缓（P1/P2）

- 多成员协作、复杂权限
- 高级统计图表与多维分析
- 自动化消息重试编排的复杂策略
- AI 能力（识别/建议）

## 1.3 上线成功标准（两周版）

- 新用户 3 分钟内完成“建宠物 + 发首条记录”
- 提醒创建成功率 ≥ 99%
- 动态发布成功率 ≥ 99%
- 线上 P1 故障 = 0

---

## 2. 架构设计（微信云开发，强调开发效率）

## 2.1 技术选型

- 前端：微信小程序原生 + TypeScript
- 后端：微信云开发（CloudBase）
  - 云数据库：业务数据
  - 云函数：鉴权、校验、写入逻辑
  - 云存储：宠物头像、动态图片
  - 云调用/订阅消息：V1 可先保留手动触达 + 站内提醒，V1.1 接入订阅消息

## 2.2 分层与职责

1. **Page 层**：页面状态、用户交互
2. **Service 层**：业务编排（如保存动态、完成提醒）
3. **Cloud Gateway 层**：统一调用云函数（错误码、重试、超时）
4. **Cloud Function 层**：权限、参数校验、事务写入
5. **Data 层**：集合 + 索引 + 存储目录

## 2.3 云函数最小集（两周内）

- `auth_bootstrap`：登录后初始化用户
- `pet_crud`：宠物档案增改查
- `post_crud`：动态新增、分页查询、软删除
- `reminder_crud`：提醒新增、列表、完成打卡
- `home_feed`：聚合首页（今日提醒 + 最近动态）

> `stats_aggregate`、`reminder_scheduler` 可放到 V1.1，避免拖慢首发节奏。

## 2.4 核心数据流

- 发布动态：图片上传云存储 -> 返回 fileID -> `post_crud.create` -> 首页/时间线刷新
- 完成提醒：`reminder_crud.complete` -> 写入 `reminder_logs` -> 更新 `next_due_at` -> 首页提醒数变化

---

## 3. 数据模型（V1）

## 3.1 集合清单（V1）

- `users`
- `pets`
- `posts`
- `reminders`
- `reminder_logs`

## 3.2 字段（核心）

### users
- `_id`（openid）
- `nickname`, `avatar_url`
- `created_at`, `updated_at`

### pets
- `_id`, `owner_openid`
- `name`, `avatar_file_id`, `species`, `breed`
- `birthday`, `gender`, `sterilized`
- `created_at`, `updated_at`, `archived`

### posts
- `_id`, `owner_openid`, `pet_id`
- `content`, `tags[]`, `image_file_ids[]`
- `event_at`, `created_at`, `updated_at`, `deleted`

### reminders
- `_id`, `owner_openid`, `pet_id`
- `type`（birthday/vaccine/deworming/cleaning/custom）
- `title`, `rule`, `next_due_at`, `last_done_at`
- `status`（active/paused）
- `created_at`, `updated_at`

### reminder_logs
- `_id`, `reminder_id`, `owner_openid`, `pet_id`
- `done_at`, `comment`

## 3.3 索引（先保性能底线）

- `pets`：`(owner_openid, archived, updated_at desc)`
- `posts`：`(owner_openid, pet_id, event_at desc)`
- `reminders`：`(owner_openid, status, next_due_at asc)`
- `reminder_logs`：`(reminder_id, done_at desc)`

---

## 4. 两周详细实施步骤（可直接执行）

## Week 1：搭骨架 + 跑通主链路

### Day 1-2：项目初始化
- 创建小程序工程（TS）
- 配置云开发环境（dev）
- 封装云函数调用工具（统一错误处理）

### Day 3-4：账号与宠物模块
- 完成 `auth_bootstrap`
- 完成 `pet_crud`（create/update/get/list）
- 页面：宠物创建页 + 宠物详情页

### Day 5-7：动态模块
- 完成图片上传组件（压缩 + 上传进度）
- 完成 `post_crud`（create/list/delete）
- 页面：发布页 + 时间线页（分页）

**Week 1 交付标准**
- 新用户可完成：登录 -> 建宠物 -> 发动态 -> 在时间线看到记录

## Week 2：提醒闭环 + 首发质量

### Day 8-10：提醒模块
- 完成 `reminder_crud`（create/list/complete）
- 页面：提醒列表 + 编辑页 + 完成打卡
- 规则：支持“按天/按月”两种周期（V1 控复杂度）

### Day 11-12：首页聚合与体验优化
- 完成 `home_feed` 云函数
- 首页展示：今日到期提醒、最近动态
- 完成空态、异常态、二次确认弹窗

### Day 13-14：测试、发布、复盘
- 冒烟测试：登录、建宠物、发动态、建提醒、完成提醒
- 修复 blocker 问题
- 提交微信审核并准备灰度发布说明

**Week 2 交付标准**
- 用户主流程全部闭环，满足首发标准并可提审

---

## 5. 增长设计与后续拓展路线（上线后 6 周）

## 5.1 增长目标拆解

- **留存**：提升 D1/D7（提醒与签到驱动）
- **活跃**：提高周记录频次（模板化记录、快捷入口）
- **传播**：增强分享裂变（宠物成长卡片）

## 5.2 版本路线图

### V1.1（上线后第 1-2 周）
- 接入订阅消息提醒（到期前一天 + 当天）
- 增加提醒“稍后处理”与红点
- 加入基础埋点看板（新增、发布、打卡转化漏斗）

### V1.2（上线后第 3-4 周）
- 多宠物支持优化（切换器 + 按宠物筛选）
- 简版数据统计（近 7/30 天记录次数、提醒完成率）
- 提供记录模板（饮食/训练/就诊）提高发帖率

### V1.3（上线后第 5-6 周）
- 家庭协作（邀请成员共管宠物）
- 成长海报分享（周报/月报）
- 会员探索（高级提醒模板、长期数据存档）

## 5.3 增长指标（建议）

- D1 留存 ≥ 35%，D7 留存 ≥ 20%
- 人均周记录数 ≥ 2.5
- 提醒创建用户占比 ≥ 60%
- 提醒完成率 ≥ 55%

---

## 6. 风险与应对（两周首发场景）

- 需求膨胀：所有需求必须标注 P0/P1，非 P0 不进两周版本
- 提审延迟：第 12 天前完成提审包，预留 2 天缓冲
- 图片上传失败：压缩 + 重传 + 降级为无图发布
- 提醒规则错误：先只支持两类周期，边界日期加单测

---

## 7. 今日即可启动的执行清单

1. 冻结 V1 范围（仅 P0）并确认页面清单
2. 创建云开发环境与 5 个核心集合
3. 建立 5 个云函数最小集
4. 先打通“登录 -> 建宠物 -> 发动态”
5. 再打通“建提醒 -> 完成打卡 -> 首页刷新”
6. 第 12 天前完成提审
